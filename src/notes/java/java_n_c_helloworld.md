(.java와 .c를 이용한) Hello, World
=========================

cafe.naver.com/cmenia에서 7월달에 스터디한 내용을 정리하여 올린 글입니다.
http://cafe.naver.com/cmenia/3511 에서도 내용을 확인하실 수 있습니다.(cafe인 경우 대화내용도 첨부되어 있습니다.)

.c를 라이브러리화 시킨후 java에서 그 라이브러리를 로드 및 호출하는 과정.

 
제 환경은 일단
```
$ uname -a
Linux pubuntu 2.6.33-co-0.8.0 #1 PREEMPT Sun Mar 21 19:46:28 UTC 2010 i686 GNU/Linux
```

// gcc와 jdk가 설치되어 있어야 합니다. 전 gcc가 이미 설치되었기 때문에 jdk를 추가로 설치하겠습니다.

```
$ sudo apt-get install sun-java6-jdk
```

open-jdk여도 무관

 

[== HelloTest.java ==]
```java
class Hello {
    native public static void hello();

    static {
        System.loadLibrary("Hello");
    }
}

class HelloTest{
    public static void main(String [] args) {
        Hello.hello();
    }
}
```
 

javah로 클래스로부터 헤더파일을 만듭니다.
```
$ javac ./HelloTest.java
$ ls
Hello.class  HelloTest.class  HelloTest.java
$ javah Hello
// 혹은 javah ./Hello.class(전자는 sun-java6-jdk, 후자는 open-jdk)
$ ls
Hello.class  Hello.h  HelloTest.class  HelloTest.java
```
 
[== Hello.h ==]
```c    
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class Hello */

#ifndef _Included_Hello
#define _Included_Hello
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     Hello
 * Method:    hello
 * Signature: ()V
 */
JNIEXPORT void JNICALL Java_Hello_hello
  (JNIEnv *, jclass);

#ifdef __cplusplus
}
#endif
#endif
```
 

굵게 표시된 것에 맞추어 소스를 작성합니다.

[== Hello.c ==]
```c
#include <stdio.h>
#include "Hello.h"

JNIEXPORT void JNICALL Java_Hello_hello (JNIEnv *env, jclass cls)
{
  printf("Hello, World\n");
}
```
 
링크를 하려면 include설정(C_INCLUDE_PATH)이 필요하고

링크된 파일을 로드하려면 로드하기 적당한 위치로(/usr/lib) 옮겨주어야 합니다.

```
$ export C_INCLUDE_PATH=/usr/lib/jvm/java-6-sun-1.6.0.20/include/:/usr/lib/jvm/java-6-sun-1.6.0.20/include/linux/
```

(jni.h: No such file or directory와 jni_md.h: No such file or directory방지// open jdk경우 설정은 또 따로 해주어야 합니다.)

```
$ ls
Hello.c  Hello.class  Hello.h  Hello.o  HelloTest.class  HelloTest.java

$ gcc -shared -o libHello.so ./Hello.o

$ java HelloTest
Exception in thread "main" java.lang.UnsatisfiedLinkError: no Hello in

java.library.path
        at java.lang.ClassLoader.loadLibrary(ClassLoader.java:1734)
        at java.lang.Runtime.loadLibrary0(Runtime.java:823)
        at java.lang.System.loadLibrary(System.java:1028)
        at Hello.<clinit>(HelloTest.java:5)
        at HelloTest.main(HelloTest.java:11)
```

lib화 시킨후 /usr/lib로 복사해주어야 합니다.

```
$ sudo cp libHello.so /usr/lib/
$ java HelloTest
Hello, World
```

-0-// 저만 신기한건가요@_@//

.java가 gcj를 거처 ELF포맷으로 변환된것도 신기하던데 이렇게 .c를 로드해서 사용하는 것을 보니 그져 컴파일러 제작자들에게 경외감이 듭니다( 정말 대단하십니다!!!)

Sun java jdk가 부담스럽다면 open jdk를 사용해도 됩니다.

아직 내공이 부족하여 안드로이드의 "안"자도 모르지만 "Java와 C를 이용한 프로 안드로이드 게임 개발 - 류광님번역" 제목과 목차를 보니 진정한 개발자(안드로이드쪽 혹은 자바)가 되려면 Java는 물론이요 C역시 내부에서 돌아가는 것부터해서 잘 알아야 할 것 같습니다.